<h3><%= @title %></h3>

<% show_part = (@num_all_posts.to_i>0 ? (1.0 * @items.length / @num_all_posts) : 0) %>

<div style="height:20px;width:590px;background-color:#ccc"><div style="height:20px;width:<%= (show_part * 590).to_i %>px;background-color:#66f;">&nbsp;</div></div>

<p><%= @items.length %> item<%= 's' if @items.length != 1 %></p>

<div style="border:1px solid #000;padding:0px 0 0 0;margin-bottom:20px;display:<%= @showing_options=='more' ? 'block' : 'none' %>" id="options_top">
  <%= render partial: 'items/geoslider_options', locals: {num: 1} %>
</div>

<% x = 0 %>
<% odd_or_even = 0 %>
<% for item in @items -%>
	<% odd_or_even = 1-odd_or_even%>
	<div class="forumitem forumitemplain forummain forum<%= odd_or_even %>" id="item_<%= item.id %>">
		<%= render :partial => "items/item", :locals => { :item => item, :itemproc=>@itemsproc[item.id], :is_reply => false, :odd_or_even => odd_or_even, :from=>@from.to_s, :top=>0, :exp_item_id=>@exp_item_id.to_i } %>
		<% if @threads == '' and @sortby != 'default' -%>
			<% @replies = Item.where("is_first_in_thread=0 and first_in_thread=#{item.id}").order("id") -%>
			<% for reply in @itemsproc[item.id]['replies'] -%>
				<% odd_or_even = 1-odd_or_even%>
				<div class="forumitem forumitemplain forumreply forum<%= odd_or_even %>" id="item_<%= reply.id %>">
					<%= render :partial => "items/item", :locals => { :item => reply, :is_reply => true, :odd_or_even => odd_or_even, :from=>@from.to_s, :top=>item.id, :exp_item_id=>@exp_item_id.to_i } %>
				</div>
			<% end -%>
    <% end -%>	
	</div><!--forumitem-->
  <% x += 1 %>
  <% break if x >= @showmax %>
<% end -%>


<div style="border:1px solid #000;padding:0px 0 0 0;margin-bottom:20px">
  <%= render partial: 'items/geoslider_options', locals: {num: 2} %>
</div>

<% if @batches.length > 0 -%>
<% step = (560 / (@batches.length-1))-15 %>
<div id="batchslider" style="margin:0 0 5px 0"></div>
<div style="width:595px;margin: 0 0 30px 0">
  <div style="float:left;width:auto;"><%= @batches[0] %></div>
  <% for x in (1..(@batches.length-1)).to_a do %>
  <div style="float:left;width:<%= step %>px">&nbsp;</div><div style="float:left;width:auto;"><%= @batches[x] %></div>
  <% end -%>
</div>
<div style="clear:both"></div>
<% end -%>



<script>
$("#geo_level").val(<%= @geo_level %>);
$("#group_level").val(<%= @group_level %>);
<% if false -%>
$("#geoslider").slider("option", "value", <%= @geo_level %>);
$("#groupslider").slider("option", "value", <%= @group_level %>);
<% end -%>
var batch_sizes = [<%= @batches.join(',') %>];
$('#batch_size').val(<%= @showmax %>);
$( "#batchslider" ).slider({
  orientation: "horizontal",
  range: "min",
  min: 1,
  max: <%= @numbatches.to_i %>,
  value: cur_batch_level,
  slide: function( event, ui ) {
    cur_batch_level = ui.value;
    $( "#batch_level" ).val( cur_batch_level );
    cur_batch_size = batch_sizes[cur_batch_level-1];
    $( "#batch_size" ).val( cur_batch_size );
    per_reload();
  }
});
$( "#batch_level" ).val( $( "#batchslider" ).slider( "value" ) );
var showing_period_id = <%= @period ? @period.id : 0 %>;
if ($('#period_id').length && $('#period_id').val()!=showing_period_id) {
  $('#period_id').val(showing_period_id);
}
</script>