<% showlong = (item.media_type!='text' or from=='individual' or (item.short_content.to_s != '' and (item.html_content.length < 140 or item.html_content == "<p>#{item.short_content}</p>"))) -%>
<% showlong = false unless showlong -%>

	<% if @error_message.to_s != '' -%>
	<p><%= @error_message %></p>
	<% end -%>

	<div class="subject subject<%= odd_or_even %>" title="<%= item.subject %>"><%= item.subject %></div>
		
	<div class="itemvoting">

		<div id="vote_int_<%= item.id %>" class="votesection interest" <% if item.voting_ok and (session[:group_id].to_i == 0 or session[:group_is_member]) %>onmouseover="intshow(<%= item.id %>,<%= top %>)" onmouseout="inthide(<%= item.id %>,<%= top %>)"<% end %>>
			<div id="intshort_<%= item.id %>" class="intshort">
				<img src="/images/sface.gif" alt="face"/>
				<span id="vote_int_rate_<%= item.id %>" title="hasrating:<%= item.hasrating.to_i if item['hasrating'].to_i > 0 %> current_participant:<%= current_participant.id %> interest:<%= item['interest'].to_i %> voting_ok:<%= item.voting_ok %>"><%= item['hasrating'].to_i > 0 ? item['rateinterest'].to_i : '-'%></span>
				<img src="/images/aface.gif" alt="face"/>
			</div>
			<div id="intlong_<%= item.id %>" class="intlong" style="display:none">
				<div class="title">interest rating</div>
				<div class="slot">&nbsp;</div><div class="slot">&nbsp;</div><div class="slot">0</div><div class="slot">1</div><div class="slot">2</div><div class="slot">3</div><div class="slot">4</div><div class="slot">&nbsp;</div><br/>
				<div class="slot">&nbsp;</div>
				<div class="slot"><img src="/images/sface.gif" alt="face"/></div>
				<div class="slot"><%= radio_button_tag "int_#{item.id}", '0', is_interest?(item,0), :onclick=>"rate('int',#{item.id},0)" %></div>
				<div class="slot"><%= radio_button_tag "int_#{item.id}", '1', is_interest?(item,1), :onclick=>"rate('int',#{item.id},1)" %></div>
				<div class="slot"><%= radio_button_tag "int_#{item.id}", '2', is_interest?(item,2), :onclick=>"rate('int',#{item.id},2)" %></div>
				<div class="slot"><%= radio_button_tag "int_#{item.id}", '3', is_interest?(item,3), :onclick=>"rate('int',#{item.id},3)" %></div>
				<div class="slot"><%= radio_button_tag "int_#{item.id}", '4', is_interest?(item,4), :onclick=>"rate('int',#{item.id},4)" %></div>
				<div class="slot"><img src="/images/aface.gif" alt="face"/></div><br/>
				<div class="bigslot left">boring!</div><div class="bigslot right">must&nbsp;see!</div>
			</div>				
		</div>
				
		<div id="vote_app_<%= item.id %>" class="votesection approval" <% if item.voting_ok and (session[:group_id].to_i == 0 or session[:group_is_member]) %>onmouseover="appshow(<%= item.id %>,<%= top %>)" onmouseout="apphide(<%= item.id %>,<%= top %>)"<% end %>>
			<div id="appshort_<%= item.id %>" class="appshort">
				<img src="/images/fface.gif" alt="face"/>				
			<span id="vote_app_rate_<%= item.id %>"><%= item['hasrating'].to_i > 0 ? item['rateapproval'].to_i : '-'%></span>
			<img src="/images/hface.gif" alt="face"/>
			</div>
			<div id="applong_<%= item.id %>" class="applong" style="display:none">
				<div class="title">approval rating</div>
				<div class="slot">&nbsp;</div><div class="slot">-3</div><div class="slot">-2</div><div class="slot">-1</div><div class="slot">0</div><div class="slot">1</div><div class="slot">2</div><div class="slot">3</div><div class="slot">&nbsp;</div><br/>
				<div class="slot"><img src="/images/fface.gif" alt="face"/></div>
				<div class="slot"><%= radio_button_tag "app_#{item.id}", '-3', is_approval?(item,-3), :onclick=>"rate('app',#{item.id},-3)" %></div>	
				<div class="slot"><%= radio_button_tag "app_#{item.id}", '-2', is_approval?(item,-2), :onclick=>"rate('app',#{item.id},-2)" %></div>	
				<div class="slot"><%= radio_button_tag "app_#{item.id}", '-1', is_approval?(item,-1), :onclick=>"rate('app',#{item.id},-1)" %></div>	
				<div class="slot"><%= radio_button_tag "app_#{item.id}", '0', is_approval?(item,0), :onclick=>"rate('app',#{item.id},0)" %></div>	
				<div class="slot"><%= radio_button_tag "app_#{item.id}", '1', is_approval?(item,1), :onclick=>"rate('app',#{item.id},1)" %></div>	
				<div class="slot"><%= radio_button_tag "app_#{item.id}", '2', is_approval?(item,2), :onclick=>"rate('app',#{item.id},2)" %></div>	
				<div class="slot"><%= radio_button_tag "app_#{item.id}", '3', is_approval?(item,3), :onclick=>"rate('app',#{item.id},3)" %></div>
				<div class="slot"><img src="/images/hface.gif" alt="face"/></div>
				<br/>
				<div class="bigslot left">disapprove</div><div class="bigslot right">approve</div>
			</div>	
		</div>				
						
		<div id="iteminfotxt_<%= item.id %>" class="votesection summary" onmouseover="summary(<%= item.id %>,<%= top %>)" onmouseout="nosummary(<%= item.id %>,<%= top %>)">
			sum
		</div>
		<div id="sum_<%= item.id %>" class="iteminfo_summary" style="display:none">
<%= render :partial => "items/rating_summary", :locals => { :item => item} %>
		</div>
		
	</div><!--itemvoting-->		


	<% if params[:test].to_i==1 and not is_reply -%>
	<div style="background-color:#eee">
		Sort Explanation: <%= item.explanation if item['explanation'] %><br>
	</div>
	<% end -%>
		
	<% if item.media_type == 'picture' -%>
		<div id="expand_<%= item.id %>" class="item_expand" onclick="expand(<%= item.id %>)">+</div>
		<div id="shortcontent_<%= item.id %>" class="htmlcontent"><img src="/images/data/items/<%= item.id %>/thumb.jpg" class="item_img_sm" alt="thumbnail"><%=raw item.short_content %><div style="clear:both;height:0px"></div></div>
		<div id="htmlcontent_<%= item.id %>" class="htmlcontent" style="display:none"><img src="/images/data/items/<%= item.id %>/big.jpg" class="item_img_lr" alt="picture"><br><%=raw item.short_content %></div>
	
	<% elsif item.media_type == 'link' -%>	
	
		<div id="expand_<%= item.id %>" class="item_expand" onclick="expand(<%= item.id %>)">−</div>
		<div id="shortcontent_<%= item.id %>" class="htmlcontent" style="display:none"><%=raw item.link %></div>
		<div id="htmlcontent_<%= item.id %>" class="htmlcontent"><%=raw item.link %></div>

	<% elsif item.media_type == 'video' -%>

		<div id="expand_<%= item.id %>" class="item_expand" onclick="expand(<%= item.id %>)">+</div>
		<div id="shortcontent_<%= item.id %>"><%=raw (item.oembed_response and item.oembed_response['thumbnail_url'].to_s!='') ? "<img src=\"#{item.oembed_response['thumbnail_url']}\" class=\"item_img_sm_w\" alt=\"thumbnail\">" : 'video' %><%=raw item.short_content %><div style="clear:both;height:0px"></div></div>
		<div id="htmlcontent_<%= item.id %>" style="display:none"><%=raw (item.oembed_response and item.oembed_response['thumbnail_url'].to_s!='') ? "<img src=\"/images/play.png\" class=\"playicon\" onclick=\"playvideo(#{ item.id})\" alt=\"play\"><img src=\"#{item.oembed_response['thumbnail_url']}\" class=\"item_img_lr\" alt=\"thumbnail\">" : 'video' %><br><%=raw item.short_content %></div>
		
	<% elsif item.media_type == 'audio' -%>
			
		<div id="expand_<%= item.id %>" class="item_expand" onclick="expand(<%= item.id %>)">+</div>
		<div id="shortcontent_<%= item.id %>"><%=raw item.oembed_response['thumbnail_url'].to_s!='' ? "<img src=\"#{item.oembed_response['thumbnail_url']}\" class=\"item_img_sm\" alt=\"thumbnail\">" : 'audio' %><%=raw item.short_content %><div style="clear:both;height:0px"></div></div>
		<div id="htmlcontent_<%= item.id %>" style="display:none"><%=raw item.oembed_response['thumbnail_url'].to_s!='' ? "<img src=\"/images/play.png\" class=\"playicon\" onclick=\"playvideo(#{ item.id})\" alt=\"play\"><img src=\"#{item.oembed_response['thumbnail_url']}\" class=\"item_img_lr\" alt=\"thumbnail\">" : 'audio' %><br><%=raw item.short_content %></div>
		
	<% else -%>
		
		<% if showlong -%>
			<div id="expand_<%= item.id %>" class="item_expand" onclick="expand(<%= item.id %>)">−</div>
			<div id="shortcontent_<%= item.id %>" class="htmlcontent" style="display:none"><%=raw item.short_content %></div>
			<div id="htmlcontent_<%= item.id %>" class="htmlcontent"><%=raw sanitizethis(item.html_content) if item.html_content.to_s != '' %></div>
		<% else -%>
			<div id="expand_<%= item.id %>" class="item_expand" onclick="expand(<%= item.id %>)">+</div>
			<div id="shortcontent_<%= item.id %>" class="htmlcontent"><%=raw item.short_content %><span onclick="expand(<%= item.id %>)" class="dot_expand" title="click to expand">...</span></div>
			<div id="htmlcontent_<%= item.id %>" class="htmlcontent" style="display:none"><%=raw sanitizethis(item.html_content) if item.html_content.to_s != '' %></div>
		<% end -%>
		
	<% end -%>
	
	
	<div class="iteminfo" id="iteminfo_<%= item.id %>">
		<div class="iteminfotxt">
		<% if @from.to_s == 'individual' || @from.to_s == 'perma' -%>	
		by 
		<% if item.dialog and item.dialog.current_period.to_i > 0 and item.period_id==item.dialog.current_period and not item.dialog.settings_with_period["names_visible_voting"] -%>
		[name withheld during decision period]
		<% elsif item.dialog and item.dialog.current_period.to_i == 0 and not item.dialog.settings_with_period["names_visible_general"] -%>
		[name withheld for this discussion]
		<% elsif item.dialog and not item.dialog.settings_with_period["profiles_visible"] -%>
		<%= item.participant ? item.participant.name : item.posted_by %>
		<% else -%>
		<a href="/participant/<%= item.posted_by %>/wall"><%= item.participant ? item.participant.name : item.posted_by %></a>
		<% end -%>
			<% if @show_meta and item.participant and item.participant.metamap_node_participants -%>
			  (<%= item.participant.metamap_node_participants.collect{|mnp| mnp.metamap_node.name}.join('|') %>)
			<% end -%>
		<% end -%>
		<%= link_to_function 'edit', "edititem(#{item.id})" if item.posted_by == current_participant.id and not item.edit_locked %>
		<%= item.created_at.strftime("%Y-%m-%d %H:%M") %>
		</div>
		
		<div class="iteminfotxt">
			<% if item.reply_ok(current_participant.id) -%>
				<%= link_to_function "Reply", "reply(#{item.id},#{is_reply})" %>	
			<% end -%>
		</div>
		
		<div class="iteminfotxt">
		<a href="/items/<%= item.id %>/view" title="permalink">#</a>	
		</div>	
		
		<div class="iteminfotxt">
			<% if @group_id.to_i > 0 and item.group and item.group_id != @group_id %><span style="color:#f99"><% end %>
			<%= "Group: " + (item.group ? item.group.name : item.group_id.to_s) if item.group %>
			<% if @group_id.to_i > 0 and item.group and item.group_id != @group_id %></span><% end %>
		</div>

		<div class="iteminfotxt">
			<%= "Discussion: " + (item.dialog ? item.dialog.name : item.dialog_id.to_s) if item.dialog %>
		</div>
			
		<div class="iteminfotxt">	
			<%= "Tags: #{item.tag_list}" if item.tag_list.to_s!='' %>			
		</div>

		<% if (@sortby == 'default' and itemproc['replies'].length > 0) or (@threads=='root' and item.num_replies > 0) %>
		<div class="iteminfotxt">
		<a href="/items/<%= item.id %>/thread" target="_blank">Show Replies</a>
		</div>
		<% end -%>
				
	</div><!--iteminfo-->
	
	<% if params[:showratings].to_i == 1 -%>
	<div>Ratings: 
	<% ratings = Rating.where(:item_id=>item.id).includes(:participant).order(:id) %>
	<%=raw ratings.length > 0 ? "<br>" : "none" %>
	<% for rating in ratings -%>
	<%= "#{rating.created_at.strftime('%Y-%m-%d %H:%M')}: #{rating.participant.name}: int:#{rating.interest ? rating.interest.to_i : 'none'} app:#{rating.approval ? rating.approval.to_i : 'none'} group:#{rating.group_id.to_i} disc:#{rating.dialog_id.to_i} period:#{rating.period_id.to_i}" %><br>
	<% end -%>
	</div>		
	<% end -%>
