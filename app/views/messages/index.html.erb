<%= render(:partial => 'menu')%>

<div id="messagelist"><%= render(:partial => 'list') %></div>
<div id="messageview" style="display:none;border:1px dotted #666;padding:10px"></div>
<div id="messageedit" style="display:none;border:1px dotted #666;padding:10px"></div>

<script>
var curid = 0;
var curinout = 'in';
function showinout(inout) {
	if (showingedit) {
		$('#messageedit').hide();
		showingedit = false;
	}
	if (showingview) {
		$('#messageview').hide();
		showingedit = false;
	}
  $('#messagelist').css('opacity','0.5');
	curinout = inout;
	$.ajax({
    type: 'GET',
    url: '/messages/list',
    data: 'inout='+inout,
    complete: function(t){	
      $("#messagelist").html(t.responseText);
		  $('#messagelist').css('opacity','1.0');
     }
   });	
}
var showingedit = false;
var showingview = false;
var replying_to = 0;
function showmess(id) {
	$("#messageview").html("Just a moment...");
  $('#messageview').show();	
  $.ajax({
    type: 'GET',
    url: '/messages/'+id,
	  data: 'inout='+curinout,
    complete: function(t){	
      $("#messageview").html(t.responseText);
		  $('#messageview').show();
			showingview = true;
			if (showingedit) {
				$('#messageedit').hide();
				showingedit = false;
			}
     }
   });	
}
function newmess() {
	if (showingview) {
		$('#messageview').hide();
		showingview = false;
	}
	if (showingedit && replying_to==0) {
		$('#messageedit').hide();
		showingedit = false;
		replying_to = 0;
		return;
	}
	$.ajax({
    type: 'GET',
    url: '/messages/new',
    complete: function(t){	
      $("#messageedit").html(t.responseText);
		  $('#messageedit').show();
			showingedit = true;
     }
   });	
}
function replymess(id) {
	if (showingview) {
		$('#messageview').hide();
		showingview = false;
	}
	replying_to = id;
	var pars = {
		response_to_id: id
	}
	$.ajax({
    type: 'GET',
    url: '/messages/new',
		data: pars,
    complete: function(t){	
      $("#messageedit").html(t.responseText);
		  $('#messageedit').show();
			showingedit = true;
     }
   });	
}
function savemess() {
	id = curid;
	if (id>0) {
		var pars = $("#edit_message_"+id).serialize();
		var url = "/messages/"+id;
		var xtype = 'PUT';
	} else {
		var pars = $("#new_message").serialize();
		var url = "/messages";
		var xtype = 'POST';
	}
 	$('#messageedit').css('opacity','0.5');
	$.ajax({
	  type: xtype,
	  url: url,
	  data: pars,
	  complete: function(t){	
			$('#messageedit').html(t.responseText);
			$('#messageedit').css('opacity','1.0');
			/* $('#messageview').hide(); */
			messlist();
		}
	 });	
}
function messlist() {
	$.ajax({
    type: 'GET',
    url: '/messages/list',
    data: 'inout='+curinout,
    complete: function(t){	
      $("#messagelist").html(t.responseText);
		  $('#messagelist').css('opacity','1.0');
     }
   });	
}
</script>